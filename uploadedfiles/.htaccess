# SECURITY: Prevent PHP script execution in upload directory
# Deny access to PHP files
<FilesMatch "\.(?i:php|php3|php4|php5|phtml|pl|py|jsp|asp|sh|cgi)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# SECURITY: Disable script execution
<IfModule mod_php7.c>
    php_flag engine off
</IfModule>
<IfModule mod_php8.c>
    php_flag engine off
</IfModule>

# SECURITY: Prevent directory listing
Options -Indexes

# SECURITY: Disable server signatures
ServerSignature Off

# SECURITY: Additional protections
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"

    # Force download for potentially dangerous files
    <FilesMatch "\.(pdf|txt)$">
        Header set Content-Disposition "attachment"
    </FilesMatch>
</IfModule>

# SECURITY: Limit upload directory access to specific file types
<FilesMatch "\.(?i:gif|jpe?g|png|pdf|txt)$">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Allow from all
    </IfModule>
</FilesMatch>
